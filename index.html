<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë©”ê°€ìŠ¤í„°ë”” ëŸ¬ì…€ ì±—ë´‡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px;
    }
    .app {
      width: 100%;
      max-width: 420px;
      background: #ffffff;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.18);
      display: flex;
      flex-direction: column;
      height: 700px;
    }
    header {
      background: #0072ff;
      color: #ffffff;
      padding: 14px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }
    header h1 {
      font-size: 16px;
      font-weight: 700;
    }
    header span {
      font-size: 12px;
      opacity: 0.9;
    }
    .chat-area {
      flex: 1;
      padding: 12px 14px;
      overflow-y: auto;
      background: #f9fafb;
    }
    .msg {
      margin-bottom: 10px;
      display: flex;
      align-items: flex-start;
      gap: 6px;
    }
    .msg-bot .bubble {
      background: #e5e7eb;
      color: #111827;
      border-radius: 14px;
      border-bottom-left-radius: 4px;
    }
    .msg-user {
      justify-content: flex-end;
    }
    .msg-user .bubble {
      background: #0072ff;
      color: #ffffff;
      border-radius: 14px;
      border-bottom-right-radius: 4px;
    }
    .bubble {
      font-size: 13px;
      padding: 9px 11px;
      line-height: 1.4;
      max-width: 85%;
      white-space: pre-line;
    }
    .link-list {
      margin-top: 6px;
      font-size: 12px;
    }
    .link-list a {
      color: #2563eb;
      text-decoration: none;
    }
    .link-list a:hover {
      text-decoration: underline;
    }

    /* ===== í…ìŠ¤íŠ¸ ì…ë ¥ ì˜ì—­ ===== */
    .input-area {
      border-top: 1px solid #e5e7eb;
      padding: 8px 10px;
      background: #ffffff;
      display: flex;
      gap: 8px;
    }
    .input-area input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 8px 12px;
      font-size: 13px;
      outline: none;
    }
    .input-area button {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 13px;
      background: #0072ff;
      color: #ffffff;
      cursor: pointer;
      white-space: nowrap;
    }
    .input-area button:hover {
      opacity: 0.9;
    }

    .btn-area {
      border-top: 1px solid #e5e7eb;
      padding: 10px 10px 14px;
      background: #ffffff;
    }
    .btn-title {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 6px;
    }
    .btn-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .chip-btn {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 7px 12px;
      font-size: 12px;
      background: #ffffff;
      cursor: pointer;
    }
    .chip-btn.main {
      font-weight: 600;
    }
    .chip-btn:hover {
      background: #f3f4f6;
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <h1>ë©”ê°€ìŠ¤í„°ë”” ëŸ¬ì…€ ì±—ë´‡</h1>
    <span>ëŒ€ì¹˜í•™ì› ì•ˆë‚´</span>
  </header>

  <div class="chat-area" id="chat"></div>

  <!-- í…ìŠ¤íŠ¸ ì…ë ¥ ì˜ì—­ -->
  <div class="input-area">
    <input
      id="user-input"
      type="text"
      placeholder="ì˜ˆ) ê³ 3 ë‹¨ê³¼ ì‹œê°„í‘œ ì•Œë ¤ì¤˜ / ì˜ì–´ 2ë“±ê¸‰ ìˆ˜ì—… ì¶”ì²œ"
    />
    <button id="send-btn">ë³´ë‚´ê¸°</button>
  </div>

  <!-- ë²„íŠ¼ ì˜ì—­ -->
  <div class="btn-area">
    <div class="btn-title" id="btn-title">ì›í•˜ì‹œëŠ” ë©”ë‰´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</div>
    <div class="btn-list" id="btn-list"></div>
  </div>
</div>

<script>
  /* ===============================
     0) russel.json ë¡œë”© (ì„±ì ë³„ ì¶”ì²œìš©)
     =============================== */
  let COURSE_DATA = [];

  fetch("russel.json")
    .then(res => res.json())
    .then(data => {
      COURSE_DATA = data;
      console.log("ì‹œê°„í‘œ JSON ë¡œë”© ì™„ë£Œ", COURSE_DATA);
    })
    .catch(err => {
      console.error("russel.json ë¡œë”© ì˜¤ë¥˜:", err);
    });

  const RECOMMEND_MENU_KEY = "ì„±ì ë³„ ìˆ˜ì—… ì¶”ì²œ";
  const SUBJECT_LIST = ["êµ­ì–´", "ìˆ˜í•™", "ì˜ì–´", "ì‚¬íšŒ", "ê³¼í•™", "ë…¼ìˆ "];
  const LEVEL_LIST = ["1~2ë“±ê¸‰", "2~3ë“±ê¸‰", "3~4ë“±ê¸‰"];

  /* ===============================
     1) ë©”ë‰´ & URL ì„¤ì •
     =============================== */
  const MENU_DATA = {

    // 1. í•™ì› ì´ìš© ê°€ì´ë“œ
    "í•™ì› ì´ìš© ê°€ì´ë“œ": [
      {
        label: "í•™ì› ê³µì§€ì‚¬í•­",
        desc: "ìµœê·¼ í•™ì› ê³µì§€ ë° ì•ˆë‚´ì‚¬í•­",
        url: "https://russeldc.megastudy.net/russel/info/notice/notice.asp"
      },
      {
        label: "ì„¤ëª…íšŒ ì˜ˆì•½/ì•Œë¦¼",
        desc: "ì„¤ëª…íšŒ ì¼ì • í™•ì¸ ë° ì•Œë¦¼ ì‹ ì²­",
        url: "https://russeldc.megastudy.net/russel/entinfo/entry_pt/enter_pt_list.asp"
      },
      {
        label: "ìì£¼í•˜ëŠ” ì§ˆë¬¸",
        desc: "ë“±ë¡, ìˆ˜ê°•, í™˜ë¶ˆ ë“± FAQ",
        url: "https://russeldc.megastudy.net/russel/info/qna/faq.asp"
      },
      {
        label: "1:1 ì˜¨ë¼ì¸ ìƒë‹´",
        desc: "ì˜¨ë¼ì¸ í•™ìŠµÂ·ì§„í•™ ìƒë‹´ ì‹ ì²­",
        url: "https://russeldc.megastudy.net/russel/info/qna/qna.asp"
      },
      {
        label: "ë‹¨ê³¼ ë§ˆê°ê°•ì¢Œ ëŒ€ê¸° ì‹ ì²­",
        desc: "ë§ˆê°ëœ ë‹¨ê³¼ ê°•ì¢Œ ëŒ€ê¸° ì‹ ì²­",
        url: "https://russeldc.megastudy.net/russel/info/waiting/list.asp?ClsCode=1"
      },
      {
        label: "ëª¨ì˜ê³ ì‚¬ êµ¬ë§¤",
        desc: "ëŸ¬ì…€ ëª¨ì˜ê³ ì‚¬ êµ¬ë§¤",
        url: "https://russeldc.megastudy.net/russel/online_mock/index.asp"
      },
      {
        label: "ë§ˆì´í˜ì´ì§€(ì¬ë“±ë¡/êµì¬/ì¢Œì„/ê¸‰ì‹)",
        desc: "ì¬ë“±ë¡, êµì¬, ì¢Œì„ì˜ˆì•½, ê¸‰ì‹ ì‹ ì²­",
        url: "https://russeldc.megastudy.net/russel/entinfo/online/service.asp"
      }
    ],

    // 2. ëª¨ì§‘ìš”ê°• ë° ë‹¨ê³¼ ì‹œê°„í‘œ
    "ëª¨ì§‘ìš”ê°• ë° ë‹¨ê³¼ ì‹œê°„í‘œ": [
      {
        label: "Nìˆ˜ ìš°ì„ ì„ ë°œë°˜ ëª¨ì§‘ìš”ê°•",
        desc: "2026 Nìˆ˜ ìš°ì„ ì„ ë°œë°˜ ëª¨ì§‘ ì•ˆë‚´",
        url: "https://russeldc.megastudy.net/intro/2026/first/index.asp"
      },
      {
        label: "ì¬í•™ìƒ ìœˆí„°ìŠ¤ì¿¨ ëª¨ì§‘ìš”ê°•",
        desc: "ì¬í•™ìƒ ìœˆí„°ìŠ¤ì¿¨ ëª¨ì§‘ ì•ˆë‚´",
        url: "https://russeldc.megastudy.net/intro/2025/winter/index.asp"
      },
      {
        label: "ê³ 3/Nìˆ˜ ë‹¨ê³¼ ì‹œê°„í‘œ",
        desc: "ê³ 3Â·Nìˆ˜ ë‹¨ê³¼ ê°•ì¢Œ ì‹œê°„í‘œ",
        url: "https://russeldc.megastudy.net/russel/campus_common/russel_danka/russel_danka_new.asp?idx=2198"
      },
      {
        label: "ê³ 2/1 ë‹¨ê³¼ ì‹œê°„í‘œ",
        desc: "ê³ 2Â·ê³ 1 ë‹¨ê³¼ ê°•ì¢Œ ì‹œê°„í‘œ",
        url: "https://russeldc.megastudy.net/russel/campus_common/russel_danka/russel_danka_new.asp?idx=2185"
      },
      {
        label: "ì‹œì¦Œ/íŠ¹ê°• ì‹œê°„í‘œ",
        desc: "ì‹œì¦ŒÂ·íŠ¹ê°•(íŒŒì´ë„ ë“±) ì‹œê°„í‘œ",
        url: "https://russeldc.megastudy.net/russel/campus_common/russel_danka/russel_danka_new.asp?idx=2184"
      },
      {
        label: "ë…¼ìˆ  íŠ¹ê°• ì‹œê°„í‘œ",
        desc: "ë…¼ìˆ  íŠ¹ê°• ì‹œê°„í‘œ",
        url: "https://russeldc.megastudy.net/russel/campus_common/russel_danka/russel_danka_new.asp?idx=2105"
      }
    ],

    // 3. ë°”ë¥¸ê³µë¶€ ììŠµì „ìš©ê´€
    "ë°”ë¥¸ê³µë¶€ ììŠµì „ìš©ê´€": [
      {
        label: "ììŠµì „ìš©ê´€ ì•ˆë‚´",
        desc: "ë°”ë¥¸ê³µë¶€ ììŠµì „ìš©ê´€ ìš´ì˜Â·ì´ìš© ì•ˆë‚´",
        url: "https://russeldc.megastudy.net/russel/info/study_hall/study_hall.asp"
      },
      {
        label: "ì¬í•™ìƒ íŠ¹ë³„ í˜œíƒ",
        desc: "ì¬í•™ìƒ ëŒ€ìƒ íŠ¹ë³„ í˜œíƒ ì•ˆë‚´",
        url: "https://russeldc.megastudy.net/russel/event/2020/megapass/megapass.asp"
      },
      {
        label: "ì£¼ê°„ ì‹ë‹¨í‘œ",
        desc: "ì´ë²ˆ ì£¼ í•™ì› ì‹ë‹¨í‘œ í™•ì¸",
        url: "https://russeldc.megastudy.net/russel/campus_common/campus/weekly_food.asp"
      }
    ],

    // 4. ëª¨ì˜ê³ ì‚¬ ì¼ì •/ì½˜í…ì¸ 
    "ëª¨ì˜ê³ ì‚¬ ì¼ì •/ì½˜í…ì¸ ": [
      {
        label: "2026ë…„ ëª¨ì˜ê³ ì‚¬ ì¼ì •",
        desc: "2026ë…„ ëŸ¬ì…€ ëª¨ì˜ê³ ì‚¬ ì¼ì • ì•ˆë‚´",
        url: "https://russeldc.megastudy.net/russel/entinfo/test_schedule.asp?year=2026"
      },
      {
        label: "OMEGA ëª¨ì˜ê³ ì‚¬",
        desc: "OMEGA ëª¨ì˜ê³ ì‚¬ ì†Œê°œ",
        url: "https://russeldc.megastudy.net/event/omega_intro/index.asp"
      },
      {
        label: "ì „êµ­ ëŒ€ë‹¨ìœ„ ì‹¤ì „ ëª¨ì˜ê³ ì‚¬",
        desc: "ì „êµ­ ëŒ€ë‹¨ìœ„ ì‹¤ì „ ëª¨ì˜ê³ ì‚¬ ì•ˆë‚´",
        url: "https://russeldc.megastudy.net/event/2025/jdsm/index.asp"
      },
      {
        label: "ë©”ëŒ€í”„ ëª¨ì˜ê³ ì‚¬",
        desc: "ë©”ëŒ€í”„ ëª¨ì˜ê³ ì‚¬ ì†Œê°œ",
        url: "https://russeldc.megastudy.net/intro/2022/premium/index.asp"
      },
      {
        label: "ALPHA ëª¨ì˜ê³ ì‚¬",
        desc: "ALPHA ëª¨ì˜ê³ ì‚¬ ì†Œê°œ",
        url: "https://russeldc.megastudy.net/event/2025/alpha/index.asp"
      }
    ],

    // 5. ì¶œê°• ì„ ìƒë‹˜ ì•ˆë‚´
    "ì¶œê°• ì„ ìƒë‹˜ ì•ˆë‚´": [
      {
        label: "êµ­ì–´",
        desc: "êµ­ì–´ ì¶œê°• ì„ ìƒë‹˜ ì†Œê°œ",
        url: "https://russeldc.megastudy.net/russel/teacher/teacher.asp?te_les=CD0023"
      },
      {
        label: "ìˆ˜í•™",
        desc: "ìˆ˜í•™ ì¶œê°• ì„ ìƒë‹˜ ì†Œê°œ",
        url: "https://russeldc.megastudy.net/russel/teacher/teacher.asp?te_les=CD0024"
      },
      {
        label: "ì˜ì–´",
        desc: "ì˜ì–´ ì¶œê°• ì„ ìƒë‹˜ ì†Œê°œ",
        url: "https://russeldc.megastudy.net/russel/teacher/teacher.asp?te_les=CD0025"
      },
      {
        label: "í•œêµ­ì‚¬",
        desc: "í•œêµ­ì‚¬ ì¶œê°• ì„ ìƒë‹˜ ì†Œê°œ",
        url: "https://russeldc.megastudy.net/russel/teacher/teacher.asp?te_les=CD0049"
      },
      {
        label: "ì‚¬íšŒ",
        desc: "ì‚¬íšŒ ì¶œê°• ì„ ìƒë‹˜ ì†Œê°œ",
        url: "https://russeldc.megastudy.net/russel/teacher/teacher.asp?te_les=CD0026"
      },
      {
        label: "ê³¼í•™",
        desc: "ê³¼í•™ ì¶œê°• ì„ ìƒë‹˜ ì†Œê°œ",
        url: "https://russeldc.megastudy.net/russel/teacher/teacher.asp?te_les=CD0027"
      },
      {
        label: "ë…¼ìˆ ",
        desc: "ë…¼ìˆ  ì¶œê°• ì„ ìƒë‹˜ ì†Œê°œ",
        url: "https://russeldc.megastudy.net/russel/teacher/teacher.asp?te_les=CD0028"
      }
    ],

    // 6. í•™ì› ì´ìš© ì•ˆë‚´
    "í•™ì› ì´ìš© ì•ˆë‚´": [
      {
        label: "í•™ì› ì‹œì„¤",
        desc: "ê°•ì˜ì‹¤, ììŠµì‹¤ ë“± ì‹œì„¤ ì•ˆë‚´",
        url: "https://russeldc.megastudy.net/russel/info/campus_facility.asp"
      },
      {
        label: "ì˜¤ì‹œëŠ” ê¸¸",
        desc: "ëŸ¬ì…€ ëŒ€ì¹˜í•™ì› ìœ„ì¹˜ ì•ˆë‚´",
        url: "https://russeldc.megastudy.net/russel/info/location.asp"
      },
      {
        label: "ë¬¸ì ì•Œë¦¼ ì‹ ì²­",
        desc: "í•™ì› ë¬¸ì ì•Œë¦¼ ì‹ ì²­/ê´€ë¦¬",
        url: "https://russeldc.megastudy.net/russel/entinfo/entry_pt/enter_pt_list.asp"
      }
    ]
  };

  /* ===============================
     2) ê³µí†µ UI í•¨ìˆ˜
     =============================== */

  const chat = document.getElementById("chat");
  const btnList = document.getElementById("btn-list");
  const btnTitle = document.getElementById("btn-title");
  const userInput = document.getElementById("user-input");
  const sendBtn = document.getElementById("send-btn");

  const MAIN_MENUS = [...Object.keys(MENU_DATA), RECOMMEND_MENU_KEY];

  function addBotMessage(text, linksHtml = "") {
    const wrap = document.createElement("div");
    wrap.className = "msg msg-bot";

    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.textContent = text;

    wrap.appendChild(bubble);

    if (linksHtml) {
      const box = document.createElement("div");
      box.className = "link-list";
      box.innerHTML = linksHtml;
      bubble.appendChild(document.createElement("br"));
      bubble.appendChild(box);
    }

    chat.appendChild(wrap);
    chat.scrollTop = chat.scrollHeight;
  }

  function addUserMessage(text) {
    const wrap = document.createElement("div");
    wrap.className = "msg msg-user";

    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.textContent = text;

    wrap.appendChild(bubble);
    chat.appendChild(wrap);
    chat.scrollTop = chat.scrollHeight;
  }

  function renderMainButtons() {
    btnTitle.textContent = "ì›í•˜ì‹œëŠ” ë©”ë‰´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.";
    btnList.innerHTML = "";
    MAIN_MENUS.forEach(menu => {
      const btn = document.createElement("button");
      btn.className = "chip-btn main";
      btn.textContent = menu;
      btn.onclick = () => {
        if (menu === RECOMMEND_MENU_KEY) {
          openRecommendFlow();
        } else {
          openMenu(menu);
        }
      };
      btnList.appendChild(btn);
    });
  }

  function openMenu(menuName) {
    const items = MENU_DATA[menuName];
    if (!items) return;

    addBotMessage(`ã€${menuName}ã€ ê´€ë ¨ ì£¼ìš” ë©”ë‰´ì…ë‹ˆë‹¤.\nì›í•˜ì‹œëŠ” í•­ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.`);

    btnTitle.textContent = `${menuName} ì„¸ë¶€ ë©”ë‰´`;
    btnList.innerHTML = "";

    items.forEach(item => {
      const btn = document.createElement("button");
      btn.className = "chip-btn";
      btn.textContent = item.label;
      btn.title = item.desc;

      btn.onclick = () => {
        const html = `<a href="${item.url}" target="_blank">${item.label} ë°”ë¡œê°€ê¸°</a>`;
        addBotMessage(`${item.label} í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.\n(${item.desc})`, html);
        window.open(item.url, "_blank");
      };

      btnList.appendChild(btn);
    });

    const homeBtn = document.createElement("button");
    homeBtn.className = "chip-btn";
    homeBtn.textContent = "â—€ ì²˜ìŒìœ¼ë¡œ";
    homeBtn.onclick = () => {
      addBotMessage("ì²˜ìŒ ë©”ë‰´ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.");
      renderMainButtons();
    };
    btnList.appendChild(homeBtn);
  }

  /* ===============================
     3) ì„±ì ë³„ ìˆ˜ì—… ì¶”ì²œ ë¡œì§
     =============================== */

  function recommendCourses(subject, levelText) {
    return COURSE_DATA.filter(item =>
      String(item.subject).replace(/\s/g, "") === subject &&
      item.level_text === levelText
    );
  }

  function showRecommendResult(subject, levelText) {
    const list = recommendCourses(subject, levelText);

    let text = `ã€${subject} / ${levelText}ã€ ìˆ˜ì—… ì¶”ì²œì…ë‹ˆë‹¤.\n\n`;

    if (list.length === 0) {
      text += "í•´ë‹¹ ì¡°ê±´ì˜ ê°•ì¢Œê°€ ì—†ìŠµë‹ˆë‹¤.";
    } else {
      list.forEach((c, idx) => {
        text += `${idx + 1}. ${c.title} - ${c.teacher}\n`;
        text += `   ìš”ì¼: ${c.day}, ì‹œê°„: ${c.time_raw}\n\n`;
      });
    }

    addBotMessage(text.trim());
    renderRecommendResultButtons(subject, levelText);
  }

  function renderRecommendResultButtons(subject, levelText) {
    btnTitle.textContent = `${subject} / ${levelText} ì¶”ì²œ ê²°ê³¼`;
    btnList.innerHTML = "";

    const againBtn = document.createElement("button");
    againBtn.className = "chip-btn";
    againBtn.textContent = "ë‹¤ë¥¸ ë“±ê¸‰ ë³´ê¸°";
    againBtn.onclick = () => renderRecommendLevelButtons(subject);
    btnList.appendChild(againBtn);

    const subjBtn = document.createElement("button");
    subjBtn.className = "chip-btn";
    subjBtn.textContent = "ê³¼ëª© ë‹¤ì‹œ ì„ íƒ";
    subjBtn.onclick = () => renderRecommendSubjectButtons();
    btnList.appendChild(subjBtn);

    const homeBtn = document.createElement("button");
    homeBtn.className = "chip-btn";
    homeBtn.textContent = "â—€ ì²˜ìŒìœ¼ë¡œ";
    homeBtn.onclick = () => renderMainButtons();
    btnList.appendChild(homeBtn);
  }

  function openRecommendFlow() {
    addBotMessage(
      "ì„±ì ë³„ ìˆ˜ì—… ì¶”ì²œì…ë‹ˆë‹¤.\n" +
      "ì›í•˜ì‹œëŠ” ê³¼ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”."
    );
    renderRecommendSubjectButtons();
  }

  function renderRecommendSubjectButtons() {
    btnTitle.textContent = "ê³¼ëª© ì„ íƒ";
    btnList.innerHTML = "";

    SUBJECT_LIST.forEach(sub => {
      const btn = document.createElement("button");
      btn.className = "chip-btn";
      btn.textContent = sub;
      btn.onclick = () => renderRecommendLevelButtons(sub);
      btnList.appendChild(btn);
    });

    const homeBtn = document.createElement("button");
    homeBtn.className = "chip-btn";
    homeBtn.textContent = "â—€ ì²˜ìŒìœ¼ë¡œ";
    homeBtn.onclick = () => renderMainButtons();
    btnList.appendChild(homeBtn);
  }

  function renderRecommendLevelButtons(subject) {
    btnTitle.textContent = subject + " / ë“±ê¸‰ ì„ íƒ";
    btnList.innerHTML = "";

    LEVEL_LIST.forEach(lv => {
      const btn = document.createElement("button");
      btn.className = "chip-btn";
      btn.textContent = lv;
      btn.onclick = () => showRecommendResult(subject, lv);
      btnList.appendChild(btn);
    });

    const backBtn = document.createElement("button");
    backBtn.className = "chip-btn";
    backBtn.textContent = "â—€ ê³¼ëª© ë‹¤ì‹œ ì„ íƒ";
    backBtn.onclick = () => renderRecommendSubjectButtons();
    btnList.appendChild(backBtn);
  }

  /* ===============================
     4) í…ìŠ¤íŠ¸ ì…ë ¥ â†’ ê³¼ëª©/ë“±ê¸‰ íŒŒì‹± & í‚¤ì›Œë“œ ë§¤ì¹­
     =============================== */

  // ë¬¸ì¥ ì•ˆì—ì„œ ê³¼ëª© ì°¾ê¸°
  function detectSubjectFromText(text) {
    for (const sub of SUBJECT_LIST) {
      if (text.includes(sub)) return sub; // "ì˜ì–´", "ìˆ˜í•™" ë“±
    }
    return null;
  }

  // ë¬¸ì¥ ì•ˆì—ì„œ ë“±ê¸‰ â†’ ìš°ë¦¬ ê¸°ì¤€ ë“±ê¸‰ëŒ€(1~2ë“±ê¸‰ ë“±)ë¡œ ë³€í™˜
  function detectLevelBandFromText(text) {
    // "1~2ë“±ê¸‰" ê°™ì´ ëŒ€ì—­ìœ¼ë¡œ ë°”ë¡œ ì“´ ê²½ìš°
    for (const band of LEVEL_LIST) {
      if (text.includes(band)) return band;
    }

    // "2ë“±ê¸‰", "3ë“±ê¸‰" ê°™ì´ í•œ ë“±ê¸‰ë§Œ ì“´ ê²½ìš°
    const m = text.match(/([1-4])\s*ë“±ê¸‰/);
    if (!m) return null;

    const g = parseInt(m[1], 10);
    if (g === 1 || g === 2) return "1~2ë“±ê¸‰";
    if (g === 3) return "2~3ë“±ê¸‰";
    if (g === 4) return "3~4ë“±ê¸‰";
    return null;
  }

  function handleTextQuery(rawText) {
    const text = rawText.trim();
    if (!text) return;

    // ğŸ” ê³¼ëª©/ë“±ê¸‰ íŒŒì‹±
    const subject = detectSubjectFromText(text);
    const levelText = detectLevelBandFromText(text);

    // âœ… "ì¶”ì²œ"ì´ë¼ëŠ” ë§ì´ ë“¤ì–´ê°€ë©´ ì„±ì ë³„ ì¶”ì²œ ì˜ë„ë¡œ ìš°ì„  ì²˜ë¦¬
    if (text.includes("ì¶”ì²œ")) {
      // ê³¼ëª© + ë“±ê¸‰ ë‘˜ ë‹¤ ìˆëŠ” ê²½ìš° â†’ ë°”ë¡œ ì¶”ì²œ ê²°ê³¼
      if (subject && levelText) {
        addBotMessage(
          `ì„±ì ë³„ ìˆ˜ì—… ì¶”ì²œì…ë‹ˆë‹¤.\nã€${subject} / ${levelText}ã€ ê¸°ì¤€ìœ¼ë¡œ ê°•ì¢Œë¥¼ ì°¾ì•„ë³¼ê²Œìš”.`
        );
        showRecommendResult(subject, levelText);
        return;
      }
      // ê³¼ëª©ë§Œ ìˆëŠ” ê²½ìš° â†’ ë“±ê¸‰ ë²„íŠ¼ í”Œë¡œìš°
      else if (subject && !levelText) {
        addBotMessage(
          `${subject} ìˆ˜ì—… ì¤‘ì—ì„œ ì–´ëŠ ë“±ê¸‰ì¸ì§€ ì•Œë ¤ì£¼ì‹œë©´ ë” ì •í™•í•œ ì¶”ì²œì´ ê°€ëŠ¥í•´ìš”.\në¨¼ì € ë“±ê¸‰ ë²„íŠ¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.`
        );
        renderRecommendLevelButtons(subject);
        return;
      }
      // ë“±ê¸‰ë§Œ ìˆëŠ” ê²½ìš° â†’ ê³¼ëª© ë²„íŠ¼ í”Œë¡œìš°
      else if (!subject && levelText) {
        addBotMessage(
          `${levelText} ê¸°ì¤€ìœ¼ë¡œ ì–´ë–¤ ê³¼ëª© ìˆ˜ì—…ì„ ì¶”ì²œë°›ê³  ì‹¶ì€ì§€ ê³¼ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.`
        );
        renderRecommendSubjectButtons();
        return;
      }
    }

    // ê¸°ì¡´ í‚¤ì›Œë“œ ì²˜ë¦¬ (ì„±ì ë³„ ì¶”ì²œ í”Œë¡œìš°)
    if (text.includes("ì„±ì ") && text.includes("ì¶”ì²œ")) {
      addBotMessage("ì„±ì ë³„ ìˆ˜ì—… ì¶”ì²œìœ¼ë¡œ ì´ë™í• ê²Œìš”.\nê³¼ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.");
      openRecommendFlow();
      return;
    }

    // ë‹¨ê³¼/ì‹œê°„í‘œ
    if (text.includes("ì‹œê°„í‘œ") || text.includes("ë‹¨ê³¼")) {
      addBotMessage("ë‹¨ê³¼ ì‹œê°„í‘œ ê´€ë ¨ ë©”ë‰´ë¥¼ ì—´ì–´ ë“œë¦´ê²Œìš”.");
      openMenu("ëª¨ì§‘ìš”ê°• ë° ë‹¨ê³¼ ì‹œê°„í‘œ");
      return;
    }

    // ììŠµì „ìš©ê´€
    if (text.includes("ììŠµ") || text.includes("ë°”ë¥¸ê³µë¶€")) {
      addBotMessage("ììŠµì „ìš©ê´€ ê´€ë ¨ ë©”ë‰´ë¥¼ ì—´ì–´ ë“œë¦´ê²Œìš”.");
      openMenu("ë°”ë¥¸ê³µë¶€ ììŠµì „ìš©ê´€");
      return;
    }

    // ëª¨ì˜ê³ ì‚¬
    if (text.includes("ëª¨ì˜ê³ ì‚¬") || text.includes("ëª¨ê³ ")) {
      addBotMessage("ëª¨ì˜ê³ ì‚¬ ê´€ë ¨ ë©”ë‰´ë¥¼ ì—´ì–´ ë“œë¦´ê²Œìš”.");
      openMenu("ëª¨ì˜ê³ ì‚¬ ì¼ì •/ì½˜í…ì¸ ");
      return;
    }

    // ì¶œê°• ì„ ìƒë‹˜
    if (text.includes("ì„ ìƒë‹˜") || text.includes("ê°•ì‚¬") || text.includes("ì¶œê°•")) {
      addBotMessage("ì¶œê°• ì„ ìƒë‹˜ ì•ˆë‚´ ë©”ë‰´ë¥¼ ì—´ì–´ ë“œë¦´ê²Œìš”.");
      openMenu("ì¶œê°• ì„ ìƒë‹˜ ì•ˆë‚´");
      return;
    }

    // í•™ì› ì´ìš© ì•ˆë‚´ (ìœ„ì¹˜/ì‹œì„¤ ë“±)
    if (
      text.includes("ê°€ëŠ”ê¸¸") ||
      text.includes("ì˜¤ì‹œëŠ” ê¸¸") ||
      text.includes("ìœ„ì¹˜") ||
      text.includes("ì‹œì„¤") ||
      text.includes("ì¢Œì„")
    ) {
      addBotMessage("í•™ì› ì´ìš© ì•ˆë‚´ ë©”ë‰´ë¥¼ ì—´ì–´ ë“œë¦´ê²Œìš”.");
      openMenu("í•™ì› ì´ìš© ì•ˆë‚´");
      return;
    }

    // ê³µì§€/FAQ
    if (text.includes("ê³µì§€") || text.includes("faq") || text.includes("ì§ˆë¬¸")) {
      addBotMessage("í•™ì› ì´ìš© ê°€ì´ë“œ ë©”ë‰´ë¥¼ ì—´ì–´ ë“œë¦´ê²Œìš”.");
      openMenu("í•™ì› ì´ìš© ê°€ì´ë“œ");
      return;
    }

    // ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ
    addBotMessage(
      "ì•„ì§ì€ ëª‡ ê°€ì§€ í‚¤ì›Œë“œë¡œë§Œ ì´í•´í•  ìˆ˜ ìˆì–´ìš”.\n" +
      "ì˜ˆ) 'ê³ 3 ë‹¨ê³¼ ì‹œê°„í‘œ', 'ììŠµì „ìš©ê´€', 'ëª¨ì˜ê³ ì‚¬ ì¼ì •', 'ì„±ì ë³„ ìˆ˜ì—… ì¶”ì²œ',\n" +
      "ë˜ëŠ” 'ì˜ì–´ 2ë“±ê¸‰ ìˆ˜ì—… ì¶”ì²œí•´ì¤˜'ì²˜ëŸ¼ ê³¼ëª©/ë“±ê¸‰ê³¼ í•¨ê»˜ ì…ë ¥í•´ ì£¼ì„¸ìš”.\n" +
      "ì•„ë˜ ë©”ë‰´ ë²„íŠ¼ì—ì„œ ì§ì ‘ ì„ íƒí•´ ì£¼ì…”ë„ ë©ë‹ˆë‹¤."
    );
    renderMainButtons();
  }

  function handleSend() {
    const text = userInput.value;
    if (!text.trim()) return;
    addUserMessage(text);
    userInput.value = "";
    handleTextQuery(text);
  }

  /* ===============================
     5) ì´ˆê¸° ì‹¤í–‰ & ì´ë²¤íŠ¸ ì—°ê²°
     =============================== */

  function init() {
    const firstMsg =
      "ì•ˆë…•í•˜ì„¸ìš”. ë©”ê°€ìŠ¤í„°ë”” ëŸ¬ì…€ ëŒ€ì¹˜í•™ì› ì±—ë´‡ì…ë‹ˆë‹¤.\n\n" +
      "í•™ì› ì´ìš©, ëª¨ì§‘ìš”ê°•, ë‹¨ê³¼ ì‹œê°„í‘œ, ììŠµì „ìš©ê´€, ëª¨ì˜ê³ ì‚¬, ì¶œê°• ì„ ìƒë‹˜ ì•ˆë‚´ì™€\n" +
      "ì„±ì ë³„ ìˆ˜ì—… ì¶”ì²œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.\n" +
      "ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ì‹œê±°ë‚˜, ì§ì ‘ ì§ˆë¬¸ì„ ì…ë ¥í•´ ë³´ì„¸ìš”.\n\n" +
      "ì˜ˆ) 'ê³ 3 ë‹¨ê³¼ ì‹œê°„í‘œ ì•Œë ¤ì¤˜', 'ì„±ì ë³„ ìˆ˜ì—… ì¶”ì²œ', 'ì˜ì–´ 2ë“±ê¸‰ ìˆ˜ì—… ì¶”ì²œí•´ì¤˜'";
    addBotMessage(firstMsg);
    renderMainButtons();
  }

  sendBtn.addEventListener("click", handleSend);
  userInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      handleSend();
    }
  });

  init();
</script>
</body>
</html>
